@using Final_PRN211_OBS_Project.Models;
@using Final_PRN211_OBS_Project.Controllers; 
@{
    ViewBag.Title = "Stock";
    Layout = "~/Views/Shared/_LayoutManager.cshtml";
    List<Book> allBooks = ViewBag.ListBook;
    DAO dao = new DAO();
}

<div class="row">
    <div class="col-md-12 col-lg-12 col-sm-12">
        <div class="white-box">
            <div id="myModal_1" class="modal">
                <!-- Modal content -->
                <form class="form-horizontal form-material">
                    <div class="modal-content">
                        <span class="close">&times;</span>
                        <p><input id="book" type="text" class="form-control p-0 border-0" name="book">
                        <p>
                            <input id="quantity" type="number" class="form-control p-0 border-0" name="quantity" value="1">
                            <br />
                            <center><button id="edit" type="submit" class="btn btn-danger text-white"><i class="fas fa-plus"></i> Update</button></center>
                    </div>
                </form>
            </div>
            @*<a href="AddBook">content</a>*@
            <div class="table-responsive">
                <table class="table no-wrap">
                    <thead>
                        <tr>
                            <th class="border-top-0">ID</th>
                            <th class="border-top-0">Title</th>
                            <th class="border-top-0">Author</th>
                            <th class="border-top-0">Price</th>
                            <th class="border-top-0">Status</th>
                            <th class="border-top-0">Quantity</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (Book item in allBooks)
                        {
                            <tr>
                                <td>@item.id</td>
                                <td class="txt-oflo">@item.title</td>
                                <td>@dao.GetAuthorById(item.author_id.ToString()).name</td>
                                <td><span class="text-success">$@item.price</span></td>
                                <td><i class="@(item.status==true?"fas fa-eye":"fas fa-eye-slash")"></i></td>
                                <td class="txt-oflo">@dao.GetStockByBookId(item.id).quantity</td>
                                <td>
                                    <div class="comment-footer d-md-flex align-items-center">
                                        <a href="javascript:void(0)" onclick="importStock(@item.id, '@item.title')" class="badge bg-primary rounded">Import</a>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div>
                <ul class="store-pagination">
                    @for (int i = 1; i <= ViewBag.PageSize; i++)
                    {
                        if (i == ViewBag.CurrentPage)
                        {
                            <li class="active">@i</li>
                        }
                        else
                        {
                            <li><a href="/ManagerDashboard/Stock?page=@i">@i</a></li>
                        }
                    }
                </ul>
            </div>
        </div>
    </div>
</div>
<script>
    function importStock(id, title) {
        var modal = document.getElementById('myModal_1');
        console.log(modal);
        var span = document.getElementsByClassName("close")[0];
        var edit = document.getElementById("edit");
        var name_input = document.getElementById("book");
        modal.style.display = "block";
        name_input.value = title;
        
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        span.onclick = function () {
            modal.style.display = "none";
        }

        edit.onclick = function () {
            var quantity = document.getElementById("quantity").value;
            var mess = "This action can not be undo, please check carefully."
            var result = confirm(mess);
            if (result) {
                location.href = '/ManagerDashboard/UpdateStock?book_id=' + id + '&quantity=' + quantity;
            }
        }
    }
</script>

<style>
    .modal {
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto; /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 30%; /* Could be more or less, depending on screen size */
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        padding-left: 320px
    }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
</style>
